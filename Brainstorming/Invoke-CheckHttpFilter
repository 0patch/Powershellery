# Invoke-CheckHttpFilter
# Author: scott sutherland
# Description The basic idea is to build out a quick script to check for access to code repo, file share, and online clipboards used by common malware. 
# Note: This is a very basic poc.  Ideally it would be nice to include common web filter categories and summary data in output. Also, runspaces for larger lists.

# Setup http handler
$HTTP_Handle = New-Object net.webclient
#$HTTP_Handle.UseDefaultCredentials

# Create data table for list of websites + categories
$WebSites = new-object System.Data.DataTable
$WebSites.Columns.Add("URL") | Out-Null

# Add sites to table
$WebSites.rows.add("https://bitbucket.org/") | out-null
$WebSites.rows.add("https://pastebin.com/") | out-null
$WebSites.rows.add("https://github.com/") | out-null
$WebSites.rows.add("https://www.dropbox.com") | out-null
$WebSites.rows.add("https://www.mediafire.com/") | out-null
$WebSites.rows.add("http://www.4shared.com/") | out-null
$WebSites.rows.add("https://www.google.com/drive/") | out-null
$WebSites.rows.add("https://onedrive.live.com/") | out-null
$WebSites.rows.add("https://www.icloud.com/") | out-null
$WebSites.rows.add("http://box.com") | out-null
$WebSites.rows.add("http://www.zippyshare.com/") | out-null
$WebSites.rows.add("http://uploaded.net/") | out-null
$WebSites.rows.add("https://www.sendspace.com/") | out-null
$WebSites.rows.add("http://www.filecrop.com/") | out-null
$WebSites.rows.add("http://pastebin.com/") | out-null
$WebSites.rows.add("https://landing.hightail.com") | Out-Null
$WebSites.rows.add("http://www.filedropper.com/") | out-null
$WebSites.rows.add("http://FriendPaste.com") | out-null
$WebSites.rows.add("http://FreeTextHost.com")| out-null
$WebSites.rows.add("http://CopyTaste.com")| out-null
$WebSites.rows.add("http://Cl1p.net")| out-null
$WebSites.rows.add("http://ShortText.com")| out-null
$WebSites.rows.add("http://http://TextSave.de")| out-null
$WebSites.rows.add("http://TextSnip.com")| out-null
$WebSites.rows.add("http://TxtB.in")| out-null

# Set proxy block string
# Note:  Need to get list of common web filter signatures
$BlockString = "URL Category Warning Acknowledgement"

# Create data table results
$ResultsTbl = new-object System.Data.DataTable
$ResultsTbl.Columns.Add("WebSite") | Out-Null
$ResultsTbl.Columns.Add("Accessible") | Out-Null

# Check website access
$WebSites | 
ForEach-Object {

    $CurrentUrl = $_.URL 
    try {

        # Send request
        $Results = $HTTP_Handle.DownloadString("$CurrentUrl")

        # Check results
        if($Results -contains "$BlockString"){
            Write-Output "Status: Blocked - $CurrentUrl"
            $ResultsTbl.Rows.Add($CurrentUrl,"No") | Out-Null
        }else{
            Write-Output "Status: Allowed - $CurrentUrl"
            $ResultsTbl.Rows.Add($CurrentUrl,"Yes") | Out-Null
        }
    }catch{
         Write-Output "Status: DNS Lookup Failed - $CurrentUrl"
         $ResultsTbl.Rows.Add($CurrentUrl,"Dead") | Out-Null
    }
}

# Return table with results
$ResultsTbl
